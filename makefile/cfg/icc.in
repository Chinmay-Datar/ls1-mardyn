# Intel compiler suite
# http://software.intel.com/en-us/intel-compilers/
# Version: 

CFG_INFO = "Intel Compiler"

CFG_PARTYPES = ""
CFG_PARTYPES += "SEQ  sequential program\n"
CFG_PARTYPES += "PAR  MPI parallel program"

CFG_TARGETS = ""
CFG_TARGETS += "DEBUG    debug version, additional output, several compiler debug options\n"
CFG_TARGETS += "COVERAGE code coverage test version\n"
CFG_TARGETS += "RELEASE  release version, compiler optimizations enabled"

CXX_SEQ = icpc
CXX_PAR = mpicxx
DEPMODE = icc

# SEQ
#########################################
# DEBUG
CXXFLAGS_SEQ_DEBUG  = -Wall -g 
LINKFLAGS_SEQ_DEBUG =
#RELEASE
CXXFLAGS_SEQ_RELEASE  = -O2 -Wall -DNDEBUG
LINKFLAGS_SEQ_RELEASE =
# CODECOV
CXXFLAGS_SEQ_COVERAGE  = $(CXXFLAGS_SEQ_RELEASE) -g -prof-gen=srcpos
LINKFLAGS_SEQ_COVERAGE = $(LINKFLAGS_SEQ_RELEASE) -g -prof-gen=srcpos

# PAR
#########################################
# DEBUG
CXXFLAGS_PAR_DEBUG  = -Wall -g -DENABLE_MPI
LINKFLAGS_PAR_DEBUG =
#RELEASE
CXXFLAGS_PAR_RELEASE  = -O2 -Wall -DNDEBUG -DENABLE_MPI
LINKFLAGS_PAR_RELEASE =
# CODECOV
CXXFLAGS_PAR_COVERAGE  = $(CXXFLAGS_PAR_RELEASE) -g -prof-gen=srcpos
LINKFLAGS_PAR_COVERAGE = $(LINKFLAGS_PAR_RELEASE) -g -prof-gen=srcpos

# Vectorization settings:
#########################################
ifeq ($(VECTORIZE_CODE),SSE)
CXXFLAGS_VECTORIZE = -msse3
endif
ifeq ($(VECTORIZE_CODE),AVX)
CXXFLAGS_VECTORIZE = -mavx
endif
ifeq ($(VECTORIZE_CODE),AVX2)
CXXFLAGS_VECTORIZE = -march=core-avx2 -fma # march=... should enable -fma automatically, but we will ensure it.
endif
ifeq ($(VECTORIZE_CODE),KNC_MASK)
CXXFLAGS_VECTORIZE = -mmic
LDFLAGS_VECTORIZE = -mmic
endif
ifeq ($(VECTORIZE_CODE),KNC_G_S)
CXXFLAGS_VECTORIZE = -mmic -D__VCP_GATHER__
LDFLAGS_VECTORIZE = -mmic
endif

# OpenMP settings:
#########################################
ifeq ($(OPENMP_SIMD),1)
CXXFLAGS_OPENMP += -qopenmp-simd
endif

# Special compile-rule for the VectorizedCellProcessor to enforce inlining.
# NOTE: depending on the installation settings, mpicxx may not actually use icpc! 
# In that case, an error may occur here!
particleContainer/adapter/VectorizedCellProcessor.o: particleContainer/adapter/VectorizedCellProcessor.cpp
	$(DEPCOMP) $(CXX) $(CXXFLAGS) -inline-forceinline -c $< -o $@
